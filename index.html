<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ramazan Hatim Rehberi - Full Versiyon</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --gold: #d4af37;
            --turquoise: #14b8a6;
            --deep-bg: #0d1b1e;
            --overlay-bg: rgba(13, 27, 30, 0.95);
            --success: #10b981;
            --danger: #ef4444;
            --whatsapp: #25d366;
        }

        html, body { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--deep-bg); }
        body {
            font-family: 'Montserrat', sans-serif;
            background: radial-gradient(circle at top, #134e4a, var(--deep-bg));
            background-attachment: fixed;
            color: white; display: flex; justify-content: center; min-height: 100vh;
            padding: 20px; box-sizing: border-box; overflow-x: hidden;
        }

        #root { width: 100%; max-width: 500px; }
        .glass-card {
            background: var(--glass-bg); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border); border-radius: 25px; padding: 25px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4); margin-bottom: 20px;
        }

        .header-actions { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .admin-badge { background: var(--gold); color: #0d1b1e; padding: 4px 8px; border-radius: 8px; font-size: 0.6rem; font-weight: bold; }
        
        .cuz-list { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 15px; }
        .cuz-item {
            aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            border-radius: 12px; border: 1px solid var(--glass-border); background: rgba(255,255,255,0.05);
            cursor: pointer; transition: 0.2s; position: relative;
        }
        .cuz-item.taken { border-color: var(--turquoise); background: rgba(20, 184, 166, 0.15); }
        .cuz-item.done { border-color: var(--gold); background: var(--success); }
        
        .cuz-num { font-size: 1.1rem; font-weight: 600; color: var(--gold); }
        .cuz-user { font-size: 0.6rem; opacity: 0.9; margin-top: 3px; text-align: center; color: white; width: 90%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        .btn { width: 100%; padding: 14px; border-radius: 15px; font-weight: 600; border: none; cursor: pointer; transition: 0.3s; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-gold { background: var(--gold); color: #0d1b1e; }
        .btn-outline { background: transparent; border: 1px solid var(--gold); color: var(--gold); font-size: 0.8rem; }
        .btn-whatsapp { background: var(--whatsapp); color: white; }
        .btn-danger { background: var(--danger); color: white; }

        .input-glass {
            width: 100%; padding: 14px; border-radius: 15px; border: 1px solid var(--glass-border);
            background: rgba(255,255,255,0.1); color: white; outline: none; margin-bottom: 10px; box-sizing: border-box;
        }

        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--overlay-bg); display: flex; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(10px); }
        .modal { background: #0d1b1e; border: 2px solid var(--gold); width: 85%; max-width: 380px; border-radius: 25px; padding: 25px; text-align: center; }
        
        .progress-bar { height: 12px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden; margin: 15px 0; border: 1px solid var(--glass-border); }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--turquoise), var(--gold)); transition: width 1s ease; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const _k1 = "AIzaSyCe";
        const _k2 = "CZ5qFTlbN8cz";
        const _k3 = "SSigydmpAQf4KMLnyh8";

        const firebaseConfig = {
            apiKey: _k1 + _k2 + _k3,
            authDomain: "kuranhatmi-e5963.firebaseapp.com",
            databaseURL: "https://kuranhatmi-e5963-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "kuranhatmi-e5963",
            storageBucket: "kuranhatmi-e5963.firebasestorage.app",
            messagingSenderId: "631276243606",
            appId: "1:631276243606:web:0f379e067527db6ad950b7"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function App() {
            const [user, setUser] = useState(localStorage.getItem('hatim_user_v1') || null);
            const [isAdmin, setIsAdmin] = useState(false);
            const [hatimData, setHatimData] = useState({});
            const [selectedCuz, setSelectedCuz] = useState(null);
            const [tempName, setTempName] = useState('');
            const [assignName, setAssignName] = useState('');

            useEffect(() => {
                db.ref('current_hatim').on('value', snap => setHatimData(snap.val() || {}));
                return () => db.ref('current_hatim').off();
            }, []);

            const login = () => {
                if (tempName.trim()) {
                    setUser(tempName.trim());
                    localStorage.setItem('hatim_user_v1', tempName.trim());
                }
            };

            const toggleAdmin = () => {
                if (isAdmin) {
                    setIsAdmin(false);
                } else {
                    const pass = prompt("YÃ¶netici ÅŸifresini girin:");
                    if (pass === "admin123") {
                        setIsAdmin(true);
                    } else {
                        alert("HatalÄ± ÅŸifre!");
                    }
                }
            };

            const takeCuz = (id, name = user) => {
                db.ref(`current_hatim/${id}`).set({ 
                    status: 'taken', 
                    owner: name,
                    startTime: Date.now() 
                });
                setSelectedCuz(null);
                setAssignName('');
            };

            const completeCuz = (id) => {
                db.ref(`current_hatim/${id}`).update({ status: 'done' });
                setSelectedCuz(null);
            };

            const resetCuz = (id) => {
                if(confirm("Bu cÃ¼zÃ¼ tekrar boÅŸa Ã§Ä±karmak istiyor musunuz?")) {
                    db.ref(`current_hatim/${id}`).remove();
                    setSelectedCuz(null);
                }
            };

            const shareHatim = (type) => {
                let text = type === 'invite' 
                    ? `ðŸ“– Ramazan Hatmimize sen de katÄ±l! Bir cÃ¼z seÃ§, hayra ortak ol: ${window.location.href}`
                    : `âœ¨ MÃ¼jdeler olsun! Bir cÃ¼zÃ¼mÃ¼ daha tamamladÄ±m. Allah kabul etsin!`;
                
                if (navigator.share) {
                    navigator.share({ title: 'Hatim Rehberi', text: text });
                } else {
                    const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
                    window.open(url, '_blank');
                }
            };

            const doneCount = Object.values(hatimData).filter(c => c.status === 'done').length;
            const progress = (doneCount / 30 * 100).toFixed(1);

            if (!user) {
                return (
                    <div className="glass-card" style={{marginTop:'50px'}}>
                        <h2 style={{textAlign:'center', color:'var(--gold)'}}>HOÅžGELDÄ°NÄ°Z</h2>
                        <input className="input-glass" placeholder="AdÄ±nÄ±z SoyadÄ±nÄ±z" value={tempName} onChange={e => setTempName(e.target.value)} />
                        <button className="btn btn-gold" onClick={login}>KATIL</button>
                    </div>
                );
            }

            return (
                <div id="main-container">
                    <div className="glass-card">
                        <div className="header-actions">
                            <span onClick={toggleAdmin} style={{cursor:'pointer', fontSize:'1.2rem'}}>{isAdmin ? 'ðŸ”“' : 'ðŸ”’'}</span>
                            {isAdmin && <span className="admin-badge">YÃ–NETÄ°CÄ° MODU</span>}
                            <span style={{fontSize:'0.7rem', opacity:0.6}}>{user}</span>
                        </div>

                        <div style={{textAlign:'center'}}>
                            <h1 style={{margin:'0', color:'var(--gold)', letterSpacing:'2px', fontSize:'1.5rem'}}>RAMAZAN HATMÄ°</h1>
                        </div>

                        <div className="progress-bar"><div className="progress-fill" style={{width: `${progress}%`}}></div></div>
                        <div style={{display:'flex', justifyContent:'space-between', fontSize:'0.7rem', color:'var(--gold)', marginBottom:'10px'}}>
                            <span>Ä°lerleme: %{progress}</span>
                            <span>{doneCount}/30 CÃ¼z Bitti</span>
                        </div>
                        
                        <div className="cuz-list">
                            {Array.from({ length: 30 }, (_, i) => {
                                const id = i + 1;
                                const info = hatimData[id] || { status: 'free', owner: '' };
                                return (
                                    <div key={id} className={`cuz-item ${info.status}`} onClick={() => setSelectedCuz({id, ...info})}>
                                        <span className="cuz-num">{id}</span>
                                        <span className="cuz-user">{info.owner || 'BoÅŸta'}</span>
                                    </div>
                                );
                            })}
                        </div>

                        <button className="btn btn-whatsapp" style={{marginTop:'20px'}} onClick={() => shareHatim('invite')}>
                            WA | GRUPTA PAYLAÅž ðŸš€
                        </button>
                    </div>

                    {selectedCuz && (
                        <div className="overlay" onClick={() => setSelectedCuz(null)}>
                            <div className="modal" onClick={e => e.stopPropagation()}>
                                <h2 style={{color:'var(--gold)'}}>{selectedCuz.id}. CÃœZ</h2>
                                
                                {selectedCuz.status === 'free' ? (
                                    <>
                                        <button className="btn btn-gold" onClick={() => takeCuz(selectedCuz.id)}>CÃœZÃœ ÃœSTLEN</button>
                                        
                                        {isAdmin && (
                                            <div style={{marginTop:'20px', borderTop:'1px solid var(--glass-border)', paddingTop:'15px'}}>
                                                <input className="input-glass" placeholder="Ä°sim yazÄ±n..." value={assignName} onChange={e => setAssignName(e.target.value)} />
                                                <button className="btn btn-outline" onClick={() => takeCuz(selectedCuz.id, assignName)}>BAÅžKASINA ATA</button>
                                            </div>
                                        )}
                                    </>
                                ) : (
                                    <>
                                        <p>Okuyan: <b>{selectedCuz.owner}</b></p>
                                        
                                        {(selectedCuz.owner === user || isAdmin) && selectedCuz.status === 'taken' && (
                                            <>
                                                <button className="btn btn-gold" onClick={() => completeCuz(selectedCuz.id)}>BÄ°TÄ°RDÄ°M âœ…</button>
                                                <button className="btn btn-whatsapp" onClick={() => shareHatim('complete')}>MÃœJDEYÄ° PAYLAÅž ðŸ“±</button>
                                            </>
                                        )}

                                        {isAdmin && (
                                            <button className="btn btn-danger" style={{marginTop:'10px'}} onClick={() => resetCuz(selectedCuz.id)}>CÃœZÃœ SIFIRLA</button>
                                        )}
                                    </>
                                )}
                                <button className="btn btn-outline" style={{marginTop:'20px'}} onClick={() => setSelectedCuz(null)}>Kapat</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
