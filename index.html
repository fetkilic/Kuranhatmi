<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ramazan Hatim Takibi - 9. GÃ¼n</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root { --gold: #d4af37; --turquoise: #14b8a6; --deep-bg: #0d1b1e; --glass: rgba(255, 255, 255, 0.1); --whatsapp: #25D366; }
        body { margin: 0; font-family: 'Montserrat', sans-serif; background: radial-gradient(circle at top, #134e4a, var(--deep-bg)); background-attachment: fixed; color: white; min-height: 100vh; display: flex; justify-content: center; padding: 20px; box-sizing: border-box; }
        #root { width: 100%; max-width: 500px; padding-bottom: 120px; }
        
        /* Progress Bar */
        .ramazan-progress-container { text-align: center; margin-bottom: 25px; padding: 10px; }
        .ramazan-label { font-size: 1.1rem; font-weight: 600; color: var(--gold); margin-bottom: 10px; display: block; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .ramazan-bar-bg { width: 100%; height: 14px; background: rgba(255,255,255,0.1); border-radius: 7px; overflow: hidden; border: 1px solid rgba(212, 175, 55, 0.4); }
        .ramazan-bar-fill { height: 100%; background: linear-gradient(90deg, #b8860b, var(--gold), #facc15); box-shadow: 0 0 10px var(--gold); transition: width 1.5s ease-in-out; }

        .glass-card { background: var(--glass); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; padding: 20px; margin-bottom: 15px; }
        .announcement-box { background: linear-gradient(45deg, var(--gold), #facc15); color: #0d1b1e; padding: 12px 40px 12px 15px; border-radius: 12px; margin-bottom: 20px; position: relative; font-weight: 600; font-size: 0.85rem; }
        .close-ann { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; font-size: 1.2rem; font-weight: bold; }

        .hatim-header { display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .cuz-container { transition: max-height 0.4s ease; overflow: hidden; }
        .collapsed { max-height: 0; }
        .expanded { max-height: 4000px; }
        
        .cuz-list { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .cuz-item { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 12px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); }
        .done { border-color: var(--gold); background: rgba(212, 175, 55, 0.2); }
        .taken { border-color: var(--turquoise); background: rgba(20, 184, 166, 0.2); }

        .btn { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; text-decoration: none; box-sizing: border-box; }
        .btn-gold { background: var(--gold); color: #0d1b1e; box-shadow: 0 4px 15px rgba(212,175,55,0.3); }
        .btn-outline { background: transparent; border: 1px solid var(--gold); color: var(--gold); margin-top: 10px; }

        .admin-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .wa-btn { background: var(--whatsapp); color: white !important; border-radius: 8px; padding: 6px 15px; text-decoration: none; font-size: 0.8rem; }

        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: flex; align-items: center; justify-content: center; z-index: 2000; }
        .modal { background: #0d1b1e; border: 1px solid var(--gold); padding: 25px; border-radius: 20px; width: 85%; max-width: 350px; text-align: center; }
        .input-glass { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.1); color: white; outline: none; box-sizing: border-box; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyCe" + "CZ5qFTlbN8cz" + "SSigydmpAQf4KMLnyh8",
            authDomain: "kuranhatmi-e5963.firebaseapp.com",
            databaseURL: "https://kuranhatmi-e5963-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "kuranhatmi-e5963"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function App() {
            const [user, setUser] = useState(JSON.parse(localStorage.getItem('hatim_user_v3')) || null);
            const [isAdmin, setIsAdmin] = useState(false);
            const [hatims, setHatims] = useState({});
            const [users, setUsers] = useState({});
            const [msg, setMsg] = useState("");
            const [hiddenMsg, setHiddenMsg] = useState(localStorage.getItem('hide_msg_v3') || "");
            const [open, setOpen] = useState({});
            const [selected, setSelected] = useState(null);
            const [form, setForm] = useState({ name: '', phone: '' });

            // GÃœN AYARI: BugÃ¼n 9. GÃ¼n
            const ramazanGunu = 9; 

            useEffect(() => {
                db.ref('parallel_hatims').on('value', s => setHatims(s.val() || {}));
                db.ref('registered_users_v3').on('value', s => setUsers(s.val() || {}));
                db.ref('system_announcement').on('value', s => setMsg(s.val() || ""));
            }, []);

            const login = () => {
                if(form.name && form.phone) {
                    const cleanPhone = form.phone.replace(/[^0-9]/g, ''); 
                    const u = { name: form.name, phone: cleanPhone, code: Math.random().toString(36).substring(7).toUpperCase() };
                    db.ref(`registered_users_v3/u_${Date.now()}`).set(u);
                    setUser(u);
                    localStorage.setItem('hatim_user_v3', JSON.stringify(u));
                }
            };

            const hatimList = Object.entries(hatims).map(([id, data]) => {
                const done = Object.values(data).filter(c => c && c.status === 'done').length;
                return { id, ...data, done, isFull: done >= 30 };
            }).sort((a,b) => (b.created || 0) - (a.created || 0));

            if (!user) return (
                <div className="glass-card" style={{marginTop: '50px'}}>
                    <h2 style={{textAlign:'center', color: 'var(--gold)'}}>RAMAZAN HATMÄ°</h2>
                    <p style={{fontSize:'0.8rem', textAlign:'center', opacity:0.8, marginBottom:'20px'}}>Ãœlke koduyla giriniz (Ã–rn: 905xx...)</p>
                    <input className="input-glass" placeholder="Ad Soyad" onChange={e=>setForm({...form, name: e.target.value})} />
                    <input className="input-glass" placeholder="Telefon (90...)" type="tel" onChange={e=>setForm({...form, phone: e.target.value})} />
                    <button className="btn btn-gold" onClick={login}>KATIL</button>
                </div>
            );

            return (
                <div>
                    {/* Progress Bar */}
                    <div className="ramazan-progress-container">
                        <span className="ramazan-label">ðŸŒ™ Ramazan'Ä±n {ramazanGunu}. GÃ¼nÃ¼</span>
                        <div className="ramazan-bar-bg">
                            <div className="ramazan-bar-fill" style={{width: `${(ramazanGunu/30)*100}%`}}></div>
                        </div>
                    </div>

                    {msg && msg !== hiddenMsg && (
                        <div className="announcement-box">
                            <span>ðŸ“¢ {msg}</span>
                            <div className="close-ann" onClick={() => { setHiddenMsg(msg); localStorage.setItem('hide_msg_v3', msg); }}>Ã—</div>
                        </div>
                    )}

                    <div style={{display:'flex', justifyContent:'space-between', padding:'10px', fontSize:'0.75rem', marginBottom:'10px'}}>
                        <span onClick={() => { if(prompt("Åžifre:") === "admin123") setIsAdmin(!isAdmin); }}>{isAdmin ? 'ðŸ”“ YÃ¶netici' : 'ðŸ”’'}</span>
                        <span>{user.name}</span>
                    </div>

                    {isAdmin && (
                        <div className="glass-card" style={{borderColor: 'var(--turquoise)'}}>
                            <h4 style={{marginTop:0}}>KullanÄ±cÄ±lar</h4>
                            {Object.values(users).map((u, i) => (
                                <div key={i} className="admin-row">
                                    <div style={{fontSize:'0.8rem'}}><b>{u.name}</b><br/><small>+{u.phone}</small></div>
                                    <a href={`https://wa.me/${u.phone}`} target="_blank" className="wa-btn">WhatsApp</a>
                                </div>
                            ))}
                        </div>
                    )}

                    {hatimList.map(h => (
                        <div key={h.id} className="glass-card" style={h.isFull ? {opacity:0.6} : {}}>
                            <div className="hatim-header" onClick={() => setOpen({...open, [h.id]: !open[h.id]})}>
                                <h3>{h.isFull ? 'âœ…' : 'ðŸ“–'} {h.name}</h3>
                                <span>{h.done}/30 {open[h.id] ? 'â–²' : 'â–¼'}</span>
                            </div>
                            <div className={`cuz-container ${open[h.id] ? 'expanded' : 'collapsed'}`}>
                                <div className="cuz-list">
                                    {Array.from({length:30}, (_,i) => {
                                        const cId = i+1; const info = h[cId] || {status:'free', owner:''};
                                        return (
                                            <div key={cId} className={`cuz-item ${info.status}`} onClick={() => setSelected({hId:h.id, cId, ...info})}>
                                                <b style={{color:'var(--gold)'}}>{cId}</b>
                                                <small style={{fontSize:'0.5rem', textAlign:'center', overflow:'hidden'}}>{info.owner || 'BoÅŸ'}</small>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    ))}

                    <div style={{position:'fixed', bottom:20, width:'90%', maxWidth:450, left:'50%', transform:'translateX(-50%)', zIndex:100}}>
                        <button className="btn btn-gold" onClick={() => {
                            const n = prompt("Hatim Grubu AdÄ±:");
                            if(n) db.ref(`parallel_hatims/h_${Date.now()}`).set({ name: n, created: Date.now() });
                        }}>+ YENÄ° HATÄ°M EKLE</button>
                    </div>

                    {selected && (
                        <div className="overlay" onClick={() => setSelected(null)}>
                            <div className="modal" onClick={e => e.stopPropagation()}>
                                <h2 style={{color:'var(--gold)'}}>{selected.cId}. CÃœZ</h2>
                                {selected.status === 'free' ? (
                                    <button className="btn btn-gold" onClick={() => { db.ref(`parallel_hatims/${selected.hId}/${selected.cId}`).set({ status:'taken', owner:user.name }); setSelected(null); }}>CÃœZÃœ ÃœSTLEN</button>
                                ) : (
                                    <>
                                        <p>Okuyan: <b>{selected.owner}</b></p>
                                        {(selected.owner === user.name || isAdmin) && selected.status === 'taken' && (
                                            <button className="btn btn-gold" onClick={() => { db.ref(`parallel_hatims/${selected.hId}/${selected.cId}`).update({ status:'done' }); setSelected(null); }}>BÄ°TÄ°RDÄ°M âœ…</button>
                                        )}
                                        {isAdmin && <button className="btn btn-outline" style={{color:'red', borderColor:'red'}} onClick={() => { db.ref(`parallel_hatims/${selected.hId}/${selected.cId}`).remove(); setSelected(null); }}>SÄ°L</button>}
                                    </>
                                )}
                                <button className="btn btn-outline" style={{marginTop:'15px'}} onClick={() => setSelected(null)}>Kapat</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
