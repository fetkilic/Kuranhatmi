<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ramazan Hatim Rehberi - Canlı</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --gold: #d4af37;
            --turquoise: #14b8a6;
            --deep-bg: #0d1b1e;
            --overlay-bg: rgba(13, 27, 30, 0.9);
            --success: #10b981;
        }

        html, body { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--deep-bg); }
        body {
            font-family: 'Montserrat', sans-serif;
            background: radial-gradient(circle at top, #134e4a, var(--deep-bg));
            background-attachment: fixed;
            color: white; display: flex; justify-content: center; min-height: 100vh;
            padding: 20px; box-sizing: border-box; overflow-x: hidden;
        }

        #root { width: 100%; max-width: 500px; }
        .glass-card {
            background: var(--glass-bg); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border); border-radius: 25px; padding: 25px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
        }

        .logo-container { text-align: center; margin-bottom: 25px; }
        .logo-icon { width: 60px; height: 60px; fill: var(--gold); filter: drop-shadow(0 0 8px rgba(212, 175, 55, 0.4)); }
        .logo-text { font-weight: 600; letter-spacing: 4px; color: var(--gold); font-size: 1.4rem; margin: 10px 0 0 0; }
        .logo-subtext { font-size: 0.7rem; color: var(--turquoise); letter-spacing: 2px; text-transform: uppercase; margin-top: 5px; }
        
        .cuz-list { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; }
        .cuz-item {
            aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            border-radius: 15px; border: 1px solid var(--glass-border); background: rgba(255,255,255,0.05);
            cursor: pointer; transition: 0.3s; position: relative;
        }
        .cuz-item.taken { border-color: var(--turquoise); background: rgba(20, 184, 166, 0.2); }
        .cuz-item.done { border-color: var(--gold); background: var(--success); }
        .cuz-num { font-size: 1.2rem; font-weight: 600; color: var(--gold); }
        .cuz-user { font-size: 0.65rem; opacity: 0.9; margin-top: 5px; text-align: center; color: white; padding: 0 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; width: 90%; }

        .btn { width: 100%; padding: 14px; border-radius: 15px; font-weight: 600; border: none; cursor: pointer; }
        .btn-gold { background: var(--gold); color: #0d1b1e; }
        .input-glass {
            width: 100%; padding: 14px; border-radius: 15px; border: 1px solid var(--glass-border);
            background: rgba(255,255,255,0.1); color: white; outline: none; margin-bottom: 15px; box-sizing: border-box;
        }

        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--overlay-bg); display: flex; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(10px); }
        .modal { background: #134e4a; border: 2px solid var(--gold); width: 85%; max-width: 350px; border-radius: 25px; padding: 30px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.6); }
        
        .progress-bar { height: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; overflow: hidden; margin: 20px 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--turquoise), var(--gold)); transition: width 1s ease; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- FIREBASE KONFİGÜRASYONU ---
        const firebaseConfig = {
            apiKey: "AIzaSyCeCZ5qFTlbN8czSSigydmpAQf4KMLnyh8",
            authDomain: "kuranhatmi-e5963.firebaseapp.com",
            databaseURL: "https://kuranhatmi-e5963-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "kuranhatmi-e5963",
            storageBucket: "kuranhatmi-e5963.firebasestorage.app",
            messagingSenderId: "631276243606",
            appId: "1:631276243606:web:0f379e067527db6ad950b7",
            measurementId: "G-M37J7VF0BH"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function App() {
            const [user, setUser] = useState(localStorage.getItem('hatim_user_v1') || null);
            const [hatimData, setHatimData] = useState({});
            const [selectedCuz, setSelectedCuz] = useState(null);
            const [tempName, setTempName] = useState('');

            // Canlı senkronizasyon
            useEffect(() => {
                const hatimRef = db.ref('hatim');
                hatimRef.on('value', (snapshot) => {
                    setHatimData(snapshot.val() || {});
                });
                return () => hatimRef.off();
            }, []);

            const login = () => {
                if (tempName.trim()) {
                    const cleanName = tempName.trim().substring(0, 20);
                    setUser(cleanName);
                    localStorage.setItem('hatim_user_v1', cleanName);
                }
            };

            const updateCuz = (id, status, owner) => {
                db.ref(`hatim/${id}`).set({ status, owner });
                setSelectedCuz(null);
            };

            const releaseCuz = (id) => {
                db.ref(`hatim/${id}`).remove();
                setSelectedCuz(null);
            };

            const doneCount = Object.values(hatimData).filter(c => c.status === 'done').length;
            const progress = (doneCount / 30 * 100).toFixed(1);

            if (!user) {
                return (
                    <div className="glass-card" style={{marginTop:'50px'}}>
                        <div className="logo-container">
                            <h1 className="logo-text">HOŞ GELDİNİZ</h1>
                            <p className="logo-subtext">Hatim Grubu İçin Adınızı Girin</p>
                        </div>
                        <input className="input-glass" placeholder="Adınız Soyadınız" value={tempName} onChange={e => setTempName(e.target.value)} />
                        <button className="btn btn-gold" onClick={login}>KATIL</button>
                    </div>
                );
            }

            return (
                <div className="glass-card">
                    <div className="logo-container">
                        <svg className="logo-icon" viewBox="0 0 24 24"><path d="M19,2H5A2,2 0 0,0 3,4V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V4A2,2 0 0,0 19,2M19,20H5V4H19V20M8,17H16V15H8V17M8,13H16V11H8V13M8,9H16V7H8V9Z" /></svg>
                        <h1 className="logo-text">RAMAZAN HATMİ</h1>
                        <p style={{color:'var(--turquoise)', fontSize:'0.8rem', marginTop:'5px'}}>Selamun Aleyküm, <b>{user}</b></p>
                    </div>

                    <div className="progress-bar"><div className="progress-fill" style={{width: `${progress}%`}}></div></div>
                    <p style={{textAlign:'center', fontSize:'0.8rem', color:'var(--gold)', fontWeight:'600'}}>Genel İlerleme: %{progress}</p>

                    <div className="cuz-list">
                        {Array.from({ length: 30 }, (_, i) => {
                            const id = i + 1;
                            const info = hatimData[id] || { status: 'free', owner: '' };
                            return (
                                <div key={id} className={`cuz-item ${info.status}`} onClick={() => setSelectedCuz({id, ...info})}>
                                    <span className="cuz-num">{id}</span>
                                    <span className="cuz-user">{info.owner || 'Boşta'}</span>
                                </div>
                            );
                        })}
                    </div>

                    {selectedCuz && (
                        <div className="overlay" onClick={() => setSelectedCuz(null)}>
                            <div className="modal" onClick={e => e.stopPropagation()}>
                                <h2 style={{color:'var(--gold)'}}>{selectedCuz.id}. CÜZ</h2>
                                
                                {selectedCuz.status === 'free' ? (
                                    <>
                                        <p>Bu cüzü okumayı üstlenmek istiyor musun?</p>
                                        <button className="btn btn-gold" onClick={() => updateCuz(selectedCuz.id, 'taken', user)}>EVET, ÜSTLENİYORUM</button>
                                    </>
                                ) : selectedCuz.owner === user ? (
                                    <>
                                        {selectedCuz.status === 'taken' ? (
                                            <>
                                                <p>Bu cüzü bitirdiysen aşağıdaki butona bas.</p>
                                                <button className="btn btn-gold" onClick={() => updateCuz(selectedCuz.id, 'done', user)}>TAMAMLADIM ✅</button>
                                                <button className="btn" style={{marginTop:'10px', background:'transparent', color:'#ef4444', fontSize:'0.8rem'}} onClick={() => releaseCuz(selectedCuz.id)}>VAZGEÇ (CÜZÜ BIRAK)</button>
                                            </>
                                        ) : <p style={{color:'var(--success)', fontWeight:'600'}}>Maşallah! Bu cüzü tamamladın.</p>}
                                    </>
                                ) : (
                                    <p>Bu cüz şu an <b>{selectedCuz.owner}</b> tarafından okunuyor.</p>
                                )}
                                
                                <button className="btn" style={{marginTop:'20px', background:'rgba(255,255,255,0.1)', color:'white'}} onClick={() => setSelectedCuz(null)}>Kapat</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
